name: Build web app
description: |
  This action builds the web version of the Flutter app using
  the `flutter build web` command. You can customize the build
  by providing various inputs such as build mode, build name, build number,
  dart defines, and more. The built web app will be output in the specified
  directory (default is `build/web`).
  The action also supports additional web-specific options such as base href,
  static assets URL, PWA strategy, and WebAssembly support.
inputs:
  dart-define:
    description: 'Dart define variables for the Flutter build (optional, format: KEY=VALUE)'
    required: false
    default: ''
  build-number:
    description: "An identifier used as an internal version number."
    required: false
    default: ''
  build-mode:
    description: 'The build mode to use when building the app. Available options: debug, profile, release. Default is release.'
    required: false
    default: 'release'
  target:
    description: 'The main entry-point file of the application (default: lib/main.dart)'
    required: false
    default: ''
  build-name:
    description: "A 'x.y.z' string used as the version number shown to users."
    required: false
    default: ''
  output:
    description: 'The absolute path to the directory where the web build output will be placed. By default, this is <current-directory>/build/web.'
    required: false
    default: ''
  no-pub:
    description: "Whether to skip running 'flutter pub get' before the build (default: false)"
    required: false
    default: 'false'
  base-href:
    description: "Overrides the href attribute of the <base> tag in web/index.html. No change is done to web/index.html file if this flag is not provided. The value has to start and end with a slash '/'."
    required: false
    default: ''
  static-assets-url:
    description: "Used when serving the static assets from a different domain the application is hosted on. The value has to end with a slash '/'."
    required: false
    default: ''
  wasm:
    description: 'Whether to build the web app with WebAssembly (default: false).'
    required: false
    default: 'false'

runs:
  using: 'composite'
  steps:
    - name: Add permissions
      run: chmod +x $GITHUB_ACTION_PATH/web.sh
      shell: bash

    - name: Build web app
      env:
        BUILD_MODE: ${{ inputs.build-mode }}
        DART_DEFINE: ${{ inputs.dart-define }}
        BUILD_NUMBER: ${{ inputs.build-number }}
        BUILD_NAME: ${{ inputs.build-name }}
        TARGET: ${{ inputs.target }}
        OUTPUT: ${{ inputs.output }}
        NO_PUB: ${{ inputs.no-pub }}
        BASE_HREF: ${{ inputs.base-href }}
        STATIC_ASSETS_URL: ${{ inputs.static-assets-url }}
        WASM: ${{ inputs.wasm }}
      run: $GITHUB_ACTION_PATH/web.sh
      shell: bash
