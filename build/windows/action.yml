name: Build windows app
description: |
  Build the Windows app using Flutter. This action will install the necessary dependencies for building
  Windows apps and then run the `flutter build windows` command with the specified options. You can
  provide a build mode, build name, build number, dart defines, and other inputs to customize the
  build. The built Windows app will be output in the `build/windows` directory of your Flutter project.

  IMPORTANT!: This action is intended for building Windows apps on a Windows runner, as it relies on
  Windows-specific dependencies and tools. It will not work on non-Windows runners. Make sure to use
  this action in a workflow that runs on a Windows runner.
inputs:
  build-mode:
    description: 'The build mode to use when building the app. Available options: debug, profile, release. Default is release.'
    required: false
    default: 'release'
  build-number:
    description: 'An identifier used as an internal version number.'
    required: false
  build-name:
    description: 'A "x.y.z" string used as the version number shown to users.'
    required: false
  no-pub:
    description: 'Whether to skip running "flutter pub get" before building the app.'
    required: false
    default: 'false'
  obfuscate:
    description: 'Whether to obfuscate the Dart code in a release build.'
    required: false
    default: 'true'
  split-debug-info:
    description: 'Directory to store Dart program symbol files for symbolizing stack traces.'
    required: false
  no-tree-shake-icons:
    description: 'Whether to disable tree shaking of icon fonts.'
    required: false
    default: 'false'
  no-analyze-size:
    description: 'Whether to disable additional profile information for artifact output size.'
    required: false
    default: 'false'
  dart-define:
    description: 'Additional key-value pairs available as constants via String.fromEnvironment.'
    required: false
  dart-define-from-file:
    description: 'Path to a .json or .env file containing key-value pairs for dart defines.'
    required: false
  target:
    description: 'The main entry-point file of the application (defaults to "lib/main.dart")'
    required: false
  track-widget-creation:
    description: 'Whether to track widget creation locations.'
    required: false
    default: 'true'
  config-only:
    description: 'Whether to update the project configuration without performing a build.'
    required: false
    default: 'false'
  code-size-directory:
    description: 'The location to write code size analysis files.'
    required: false

runs:
  using: 'composite'
  steps:
    - name: Add permissions
      run: chmod +x $GITHUB_ACTION_PATH/windows.sh
      shell: bash

    - name: Build Windows app
      env:
        BUILD_MODE: ${{ inputs.build-mode }}
        BUILD_NAME: ${{ inputs.build-name }}
        BUILD_NUMBER: ${{ inputs.build-number }}
        NO_PUB: ${{ inputs.no-pub }}
        OBFUSCATE: ${{ inputs.obfuscate }}
        SPLIT_DEBUG_INFO: ${{ inputs.split-debug-info }}
        NO_TREE_SHAKE_ICONS: ${{ inputs.no-tree-shake-icons }}
        NO_ANALYZE_SIZE: ${{ inputs.no-analyze-size }}
        DART_DEFINE: ${{ inputs.dart-define }}
        DART_DEFINE_FROM_FILE: ${{ inputs.dart-define-from-file }}
        TARGET: ${{ inputs.target }}
        TRACK_WIDGET_CREATION: ${{ inputs.track-widget-creation }}
        CONFIG_ONLY: ${{ inputs.config-only }}
        CODE_SIZE_DIRECTORY: ${{ inputs.code-size-directory }}
      run: $GITHUB_ACTION_PATH/windows.sh
      shell: bash
