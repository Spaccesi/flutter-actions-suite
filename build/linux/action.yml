name: Build Linux
description: |
  Build the Linux app using Flutter. This action will install the necessary dependencies for building
  Linux apps and then run the `flutter build linux` command with the specified options. You can
  provide a flavor, build name, build number, and dart defines as inputs to customize the build.
  The built Linux app will be output in the `build/linux` directory of your Flutter project.

  IMPORTANT!: This action is intended for building Linux apps on a Linux runner, as it relies on
  Linux-specific dependencies and tools. It will not work on non-Linux runners. Make sure to use
  this action in a workflow that runs on a Linux runner.
inputs:
  build-mode:
    description: 'The build mode to use when building the app. Available options: debug, profile, release. Default is release.'
    required: false
    default: 'release'
  build-name:
    description: 'The build name to use for the Linux app.'
    required: false
    default: ''
  build-number:
    description: 'The build number to use for the Linux app.'
    required: false
    default: ''
  dart-define:
    description: 'Dart defines in KEY=VALUE format, one per line.'
    required: false
    default: ''
  dart-define-from-file:
    description: 'Path to a file containing Dart define variables for the Flutter build (optional)'
    required: false
  obfuscate:
    description: 'Whether to obfuscate the Dart code in release builds (default: false).'
    required: false
    default: 'false'
  no-pub:
    description: 'Whether to skip running pub get before building.'
    required: false
    default: 'false'
  split-debug-info:
    description: 'Directory to store Dart program symbol files for symbolizing stack traces.'
    required: false
  no-tree-shake-icons:
    description: 'Whether to disable tree shaking of icon fonts.'
    required: false
    default: 'false'
  no-analyze-size:
    description: 'Whether to disable additional profile information for artifact output size.'
    required: false
    default: 'false'
  code-size-directory:
    description: 'The location to write code size analysis files.'
    required: false
  target-platform:
    description: 'The target platform to build for (e.g. "linux-x64", "linux-arm64").'
    required: false
  target-sysroot:
    description: 'The target system root to build for.'
    required: false

runs:
  using: 'composite'
  steps:
    - name: Add permissions
      run: chmod +x $GITHUB_ACTION_PATH/linux.sh
      shell: bash

    - name: Build Linux app
      env:
        BUILD_MODE: ${{ inputs.build-mode }}
        BUILD_NAME: ${{ inputs.build-name }}
        BUILD_NUMBER: ${{ inputs.build-number }}
        DART_DEFINE: ${{ inputs.dart-define }}
        DART_DEFINE_FROM_FILE: ${{ inputs.dart-define-from-file }}
        OBFUSCATE: ${{ inputs.obfuscate }}
        NO_PUB: ${{ inputs.no-pub }}
        SPLIT_DEBUG_INFO: ${{ inputs.split-debug-info }}
        NO_TREE_SHAKE_ICONS: ${{ inputs.no-tree-shake-icons }}
        NO_ANALYZE_SIZE: ${{ inputs.no-analyze-size }}
        CODE_SIZE_DIRECTORY: ${{ inputs.code-size-directory }}
        TARGET_PLATFORM: ${{ inputs.target-platform }}
        TARGET_SYSROOT: ${{ inputs.target-sysroot }}
      run: $GITHUB_ACTION_PATH/linux.sh
      shell: bash
